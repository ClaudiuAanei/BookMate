{% load static %}

<link rel="stylesheet" href="{% static 'css/employee/shell/navbar.css' %}">

<nav class="bg-[#09090b]/90 backdrop-blur-md sticky top-0 z-40 border-b border-white/5 h-20">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full">
    <div class="flex justify-between items-center h-full gap-8">

      <!-- LEFT: Avatar / Name -->
      <a href="{% url 'employee_dashboard' %}" 
        class="group flex items-center gap-5 p-2 cursor-pointer select-none transition-transform duration-150 active:scale-95 no-underline">
          
          <div class="relative">
              <div id="user-initials" class="h-12 w-12 rounded-lg bg-slate-900 border border-slate-800 flex items-center justify-center text-slate-400 font-serif text-lg transition-colors duration-300 group-hover:border-blue-500/50 group-hover:text-blue-200">
                  {{ user.employee.fullname|slice:":1" }}
              </div>
              <div class="absolute -bottom-1 -right-1 h-3 w-3 rounded-full bg-primary flex items-center justify-center">
                  <div class="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse_slow"></div>
              </div>
          </div>
          
          <div class="flex flex-col justify-center">
              <div class="relative inline-block w-fit">
                  <span id="user-name" class="text-base font-bold text-slate-300 transition-colors duration-300 group-hover:text-white">
                      {{ user.employee.fullname }}
                  </span>
                  <span class="absolute left-0 -bottom-0.5 h-[1px] w-0 bg-blue-500 transition-all duration-300 group-hover:w-full"></span>
              </div>
              
              <span class="text-[10px] uppercase tracking-[0.2em] text-slate-500 font-medium mt-1 group-hover:text-slate-400 transition-colors">
                  Employee
              </span>
          </div>
      </a>

      <!-- SEARCH (client picker) -->
      <div class="flex-1 max-w-2xl relative z-50" data-client-picker data-search-url="{% url 'search_client' %}">
        <div class="relative w-full">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i class="ph ph-magnifying-glass text-gray-500 text-lg"></i>
          </div>

          <input
            type="text"
            class="block w-full pl-10 pr-32 py-3 border border-white/10 rounded-xl leading-5 bg-[#18181b] text-gray-100 placeholder-gray-600 focus:outline-none focus:bg-[#202025] focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition duration-200 text-sm shadow-sm font-medium"
            placeholder="Search client (name, phone, email)..."
            autocomplete="off"
            data-client-search-input
          />

          <!-- Clear selection (X) - hidden until a client is selected -->
          <button
            type="button"
            class="absolute inset-y-0 right-20 pr-2 flex items-center cursor-pointer group/icon hidden"
            title="Clear selected client"
            data-client-clear-btn
          >
            <i class="ph ph-x text-gray-600 group-hover/icon:text-gray-300 transition-colors"></i>
          </button>

          <!-- Quick Edit - hidden until a client is selected -->
          <button
            type="button"
            class="absolute inset-y-0 right-10 pr-2 flex items-center cursor-pointer group/icon hidden"
            title="Edit selected client"
            data-client-edit-btn
          >
            <i class="ph ph-pencil-simple text-gray-600 group-hover/icon:text-gray-300 transition-colors"></i>
          </button>

          <!-- Add button -->
          <button
            type="button"
            class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer group/icon"
            title="Add new client"
            data-client-add-btn
          >
            <i class="ph ph-plus text-gray-600 group-hover/icon:text-gray-300 transition-colors"></i>
          </button>
        </div>

        <!-- RESULTS DROPDOWN -->
        <div
          class="absolute top-full left-0 w-full mt-2 bg-[#18181b] rounded-xl shadow-2xl border border-white/10 overflow-hidden hidden origin-top z-50 shadow-black/80"
          data-client-results
        >
          <div class="bg-white/5 px-4 py-2 border-b border-white/5 flex justify-between items-center">
            <span class="text-xs font-bold text-gray-500 uppercase tracking-wider" data-client-results-title>
              Clients Found (0)
            </span>
          </div>

          <div class="max-h-[300px] overflow-y-auto custom-scrollbar" data-client-results-list>
            <!-- JS inject results here -->
          </div>

          <div class="sticky bottom-0 bg-[#18181b] border-t border-white/5 p-2">
            <button
              type="button"
              class="w-full flex items-center justify-center gap-2 py-2.5 rounded-lg bg-blue-500 text-white text-sm font-semibold hover:bg-blue-400 transition-colors shadow-lg shadow-violet-900/20"
              data-client-add-footer-btn
            >
              <i class="ph ph-plus text-base"></i>
              Add New Client
            </button>
          </div>
        </div>
      </div>
      <!-- RIGHT: Services Selector -->
      <div class="w-64 flex justify-end items-center">
        <!-- SERVICES SELECTOR DROPDOWN -->
        <div class="relative group z-50 w-72" data-services-dropdown>
          <!-- Trigger Button -->
          <button
            type="button"
            class="w-full h-12 flex items-center justify-between px-4 rounded-xl bg-[#18181b] border border-white/10 hover:border-blue-500/50 hover:bg-[#202025] transition-all outline-none group-hover:ring-2 group-hover:ring-blue-500/10 shadow-lg shadow-black/20 relative"
            data-services-btn
            aria-haspopup="listbox"
            aria-expanded="false"
          >
            <div class="flex items-center gap-3">
              <div class="relative">
                <div class="p-0.5 rounded-lg bg-blue-500/10 text-blue-400 group-hover:bg-blue-500 group-hover:text-white transition-colors">
                  <i class="ph ph-list-checks text-base"></i>
                </div>

                <!-- BADGE -->
                <div
                  class="absolute -top-1.5 -right-1.5 h-4 w-4 rounded-full bg-red-500 text-white text-[9px] font-bold flex items-center justify-center opacity-0 scale-0 transition-all duration-300 shadow-sm border border-[#18181b] z-10"
                  data-services-badge
                >0</div>
              </div>

              <div class="flex flex-col items-start truncate">
                <span class="font-semibold text-sm text-gray-200 group-hover:text-white truncate" data-services-label>
                  Select Services
                </span>
                <span class="text-[11px] text-gray-400 group-hover:text-gray-400" data-services-meta>
                  Multiple allowed
                </span>
              </div>
            </div>

            <i class="ph ph-caret-down text-gray-500 group-hover:text-blue-400 transition-transform duration-300 group-hover:rotate-180 text-xs ml-2"></i>
          </button>

          <!-- Dropdown Menu -->
          <!-- Hover bridge: acoperă spațiul dintre button și menu (mt-2) -->
          <div class="absolute right-0 top-full h-2 w-full" data-services-bridge></div>

          <div
            class="services-menu absolute top-full right-0 mt-2 w-full origin-top-right transform scale-95 opacity-0 invisible transition-all duration-200 ease-out"
            data-services-menu
          >
            <div class="bg-[#18181b] border border-white/10 rounded-xl shadow-2xl shadow-black/90 overflow-hidden ring-1 ring-white/5 backdrop-blur-xl">

              <div class="px-4 py-2.5 border-b border-white/5 bg-white/[0.02] flex justify-between items-center">
                <span class="text-[10px] font-bold text-gray-500 uppercase tracking-widest">Available Options</span>
                <span class="text-[10px] text-blue-400/80 bg-blue-500/10 px-1.5 py-0.5 rounded border border-blue-500/20">
                  Multi-select
                </span>
              </div>

              <!-- LIST (server-rendered, NO JSON) -->
              <div class="p-1.5 space-y-1 max-h-64 overflow-y-auto custom-scrollbar" data-services-list role="listbox">
                {% for s in services %}
                  <label
                    class="flex items-center justify-between px-3 py-3 rounded-lg hover:bg-blue-500/10 cursor-pointer group/item transition-colors relative border border-transparent hover:border-blue-500/20"
                    data-service-row
                  >
                    <div class="flex items-center gap-3">
                      <input
                        type="checkbox"
                        class="peer hidden"
                        name="service_type"
                        value="{{ s.id }}"
                        data-service-id="{{ s.id }}"
                        data-service-name="{{ s.name }}"
                        data-service-price="{{ s.price }}"
                        data-service-duration="{{ s.duration }}"
                      >
                      <div class="w-5 h-5 rounded-md border border-gray-600 group-hover/item:border-blue-500 flex items-center justify-center transition-all peer-checked:border-blue-500 peer-checked:bg-blue-500 shadow-sm peer-checked:[&>i]:opacity-100">
                        <i class="ph-bold ph-check text-white text-[10px] opacity-0 transform scale-50 peer-checked:scale-100 transition-all"></i>
                      </div>

                      <div class="flex flex-col">
                        <span class="text-sm font-medium text-gray-300 group-hover/item:text-white peer-checked:text-blue-400 transition-colors">
                          {{ s.name }}
                        </span>
                        {% if s.description %}
                          <span class="text-[10px] text-gray-600 group-hover/item:text-gray-500">{{ s.description }}</span>
                        {% else %}
                          <span class="text-[10px] text-gray-600 group-hover/item:text-gray-500">—</span>
                        {% endif %}
                      </div>
                    </div>

                    <div class="flex flex-col items-end gap-0.5">
                      <span
                        class="text-sm font-bold text-emerald-400"
                        data-service-price-text
                      >
                        {{ s.price }}
                      </span>
                      <div class="flex items-center gap-1 text-[10px] text-gray-500">
                        <i class="ph ph-clock"></i>
                        <span data-service-duration-text>{{ s.duration }}</span>
                      </div>
                    </div>

                    <div class="absolute inset-0 border border-blue-500/30 rounded-lg opacity-0 peer-checked:opacity-100 pointer-events-none shadow-[0_0_10px_rgba(59,130,246,0.1)]"></div>
                  </label>
                {% endfor %}
              </div>

              <!-- Footer -->
              <div class="p-2 border-t border-white/5 bg-white/[0.02] flex items-center gap-2">
                <button
                  type="button"
                  class="px-3 py-2.5 rounded-lg text-red-400 hover:bg-red-500/10 hover:text-red-300 text-xs font-semibold transition-all opacity-0 pointer-events-none whitespace-nowrap"
                  data-services-clear
                  title="Reset Selection"
                >
                  Clear
                </button>

                <button
                  type="button"
                  class="flex-1 py-2.5 rounded-lg bg-blue-600 hover:bg-blue-500 text-xs font-bold text-white transition-all shadow-lg shadow-blue-900/20 flex items-center justify-center gap-2"
                  data-services-confirm
                >
                  <i class="ph ph-check text-sm"></i>
                  Confirm Selection
                </button>
              </div>

            </div>
          </div>
        </div>
      </div>


    </div>
  </div>
</nav>


    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const nameElement = document.getElementById('user-name');
            const initialsElement = document.getElementById('user-initials');

            if (nameElement && initialsElement) {
                // Preia textul din nume (ex: "Alex Popescu")
                const name = nameElement.innerText.trim();
                
                // Extrage prima literă din fiecare cuvânt și le unește
                const initials = name.split(' ')
                                     .filter(word => word.length > 0)
                                     .map(word => word[0])
                                     .join('')
                                     .toUpperCase()
                                     .substring(0, 2); // Păstrează maxim 2 litere

                // Actualizează elementul cu inițialele
                initialsElement.innerText = initials;
            }
        });
    </script>